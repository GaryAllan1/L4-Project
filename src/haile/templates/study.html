<!DOCTYPE html>
{% extends "base.html" %}

{% block body_block %}

<div class="container mt-5">
    <div class="chat-container border p-3 rounded">
        <div class="chat-header text-center">
            <h1>Chat-Bot</h1>
        </div>
        <div class="chat-messages">
            <!-- Bot's initial message -->
            <div class="message alert alert-success" role="alert">
                Welcome to the chat-bot! How can I assist you?
            </div>
        </div>
        <!-- User input form -->
        <form id="chat-form" method="post" class="mt-3">
            {% csrf_token %}
            <div class="input-group">
                <input type="text" name="prompt_text" id="user-input" class="form-control" placeholder="Type your message..." required>
                <button type="submit" class="btn btn-success">Send</button>
            </div>
        </form>
    </div>
</div>

<style>
    .message {
        margin-bottom: 10px;
    }

    .message-user {
        background-color: #f3f3e8;
    }

    .message-bot {
        background-color: #3e4ab8;
        color: #fff;
    }

    .response {
        display: none;
    }

    .chat-container {
        display: flex;
        flex-direction: column;
        max-height: 400px;
        overflow-y: auto;
    }

    .chat-messages {
        flex-grow: 1;
    }
</style>
{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function () {
        $("#chat-form").submit(function (e) {
            e.preventDefault();

            var userMessage = $("#user-input").val();
            if(userMessage.trim() == '') {
                return; // Don't add empty messages to the chat
            }

            var userMessageHtml = '<div class="message-user alert alert-primary" role="alert">' + userMessage + '</div>';
            $(".chat-messages").append(userMessageHtml);

            $("#user-input").val("");

            $.ajax({
                url: {% url 'study' %},
                type: 'POST',
                data: {
                    csrfmiddlewaretoken: $("[name=csrfmiddlewaretoken]").val(), // Include the CSRF token
                    prompt_text: userMessage,
                },
                success: function (response) {
                    var responseHTML = '<div class="message-bot alert alert-primary" role="alert">' + response['response'] + '</div>';
                    $(".chat-messages").append(responseHTML);
                },
                error: function (response) {
                    console.log(response)
                },
            });
        });
    })
</script>
{% endblock %}